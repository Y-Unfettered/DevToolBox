<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>程序员工具合集 - 数据统计</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.iconify.design/3/3.1.1/iconify.min.js"></script>
  <style>
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
  </style>
</head>
<body class="bg-[#0f172a] text-slate-200 font-sans min-h-screen">
  <div class="flex h-screen overflow-hidden">
    <aside class="w-64 bg-[#1e293b] border-r border-slate-700 flex flex-col">
      <div class="p-6 flex items-center space-x-3">
        <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center">
          <span class="iconify text-2xl text-white" data-icon="heroicons:command-line-20-solid"></span>
        </div>
        <span class="text-xl font-bold tracking-tight text-white">工具管理后台</span>
      </div>
      <nav class="flex-1 mt-4 px-4 space-y-2">
        <a class="flex items-center space-x-3 text-slate-400 hover:bg-slate-800 hover:text-slate-200 px-4 py-3 rounded-xl transition-all" href="admin.html">
          <svg class="w-5 h-5 text-current" viewBox="0 0 1024 1024" aria-hidden="true">
            <path d="M536.508695 515.037173 533.082666 506.909052 528.910647 510.318708Z" fill="currentColor"></path>
            <path d="M431.339424 549.69553 194.782753 549.69553c-21.871123 0-39.666418 17.796318-39.666418 39.667441l0 236.553601c0 21.87317 17.795295 39.667441 39.666418 39.667441l236.556671 0c21.871123 0 39.665395-17.794271 39.665395-39.667441L471.004819 589.362972C471.004819 567.491849 453.210547 549.69553 431.339424 549.69553zM430.205601 824.780703 195.9176 824.780703 195.9176 590.497818l234.288001 0L430.205601 824.780703z" fill="currentColor"></path>
            <path d="M192.211185 508.24242l236.557694 0c21.871123 0 39.665395-17.794271 39.665395-39.664372l0-236.557694c0-21.871123-17.794271-39.664372-39.665395-39.664372L192.211185 192.355983c-21.871123 0-39.664372 17.793248-39.664372 39.664372l0 236.557694C152.547837 490.448148 170.340061 508.24242 192.211185 508.24242zM193.349101 233.155201l234.284931 0 0 234.285954L193.349101 467.441155 193.349101 233.155201z" fill="currentColor"></path>
            <path d="M813.097104 547.127032 576.541457 547.127032c-21.862937 0-39.646975 17.794271-39.646975 39.665395l0 236.555647c0 21.871123 17.784038 39.665395 39.646975 39.665395l236.555647 0c21.881356 0 39.683814-17.794271 39.683814-39.665395L852.780919 586.792427C852.780919 564.921303 834.978461 547.127032 813.097104 547.127032zM811.980677 822.213227 577.69677 822.213227 577.69677 587.927273l234.283908 0L811.980677 822.213227z" fill="currentColor"></path>
            <path d="M859.52553 314.327942 720.943264 175.745676c-7.087419-7.064906-16.504906-10.956539-26.51591-10.956539-10.008958 0-19.422352 3.891633-26.5374 10.981099L529.377274 314.303382c-7.110955 7.089465-11.026124 16.522302-11.026124 26.561959s3.91517 19.473517 11.000542 26.536376l138.539286 138.559752c7.080256 7.080256 16.501836 10.980076 26.529213 10.980076 10.016121 0 19.436678-3.891633 26.547633-10.980076L859.550089 367.380228C874.147552 352.73774 874.136296 328.939731 859.52553 314.327942zM694.429401 471.41363 563.900555 340.865341 694.429401 210.318076l130.547265 130.547265L694.429401 471.41363z" fill="currentColor"></path>
            <path d="M432.577624 550.656415 195.628004 550.656415c-21.911032 0-39.737026 17.825994-39.737026 39.739073l0 236.947574c0 21.908986 17.825994 39.730886 39.737026 39.730886l236.94962 0c21.906939 0 39.729863-17.821901 39.729863-39.730886L472.307488 590.395488C472.307488 568.482409 454.484563 550.656415 432.577624 550.656415z" fill="currentColor"></path>
            <path d="M193.054389 509.131673 429.996846 509.131673c21.911032 0 39.737026-17.823947 39.737026-39.729863L469.733872 232.452189c0-21.905916-17.824971-39.729863-39.737026-39.729863L193.054389 192.722326c-21.911032 0-39.73805 17.823947-39.73805 39.729863l0 236.94962C153.317363 491.307725 171.143357 509.131673 193.054389 509.131673z" fill="currentColor"></path>
            <path d="M814.956452 548.084846 578.007855 548.084846c-21.894659 0-39.709397 17.825994-39.709397 39.737026l0 236.941434c0 21.911032 17.813714 39.737026 39.709397 39.737026l236.948597 0c21.919219 0 39.752376-17.825994 39.752376-39.737026L854.708827 587.821873C854.707804 565.91084 836.874647 548.084846 814.956452 548.084846z" fill="currentColor"></path>
            <path d="M861.463672 314.897923 722.654232 176.09667c-7.098675-7.082302-16.533558-10.983145-26.565029-10.983145-10.027377 0-19.461237 3.900843-26.578332 11.002588L530.769994 314.871317c-7.124258 7.099698-11.047614 16.548908-11.047614 26.606984 0 10.060123 3.923356 19.508309 11.019984 26.579355l138.770554 138.79409c7.092535 7.092535 16.529465 10.998495 26.573215 10.998495 10.037611 0 19.472494-3.900843 26.587542-10.998495l138.817626-138.818649C876.107183 353.365027 876.095927 329.529155 861.463672 314.897923zM696.092273 472.244554 565.348534 341.478302l130.744763-130.757043 130.765229 130.757043L696.092273 472.244554z" fill="currentColor"></path>
            <path d="M537.607726 518.65149 534.18272 510.522346 530.009677 513.932002Z" fill="currentColor"></path>
          </svg>
          <span class="font-medium">工具管理</span>
        </a>
        <a class="flex items-center space-x-3 text-slate-400 hover:bg-slate-800 hover:text-slate-200 px-4 py-3 rounded-xl transition-all" href="categories.html">
          <span class="iconify text-xl" data-icon="heroicons:tag-20-solid"></span>
          <span class="font-medium">分类管理</span>
        </a>
        <a class="flex items-center space-x-3 bg-indigo-600/10 text-indigo-400 px-4 py-3 rounded-xl border border-indigo-500/20 shadow-lg shadow-indigo-500/5" href="stats.html">
          <span class="iconify text-xl" data-icon="heroicons:chart-bar-20-solid"></span>
          <span class="font-medium">数据统计</span>
        </a>
        <a class="flex items-center space-x-3 text-slate-400 hover:bg-slate-800 hover:text-slate-200 px-4 py-3 rounded-xl transition-all" href="settings.html">
          <span class="iconify text-xl" data-icon="heroicons:cog-6-tooth-20-solid"></span>
          <span class="font-medium">系统设置</span>
        </a>
      </nav>
      <div class="p-4 border-t border-slate-700">
        <div class="flex items-center space-x-3 px-4 py-2 hover:bg-slate-800 rounded-xl cursor-pointer">
          <div class="w-8 h-8 rounded-full border border-slate-600 bg-slate-800 flex items-center justify-center">
            <span class="iconify text-slate-400" data-icon="heroicons:user-20-solid"></span>
          </div>
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium text-white truncate">Admin User</p>
            <p class="text-xs text-slate-500 truncate">2026-01-28</p>
          </div>
          <span class="iconify text-slate-500" data-icon="heroicons:arrow-right-on-rectangle-20-solid"></span>
        </div>
      </div>
    </aside>

    <main class="flex-1 flex flex-col overflow-hidden">
      <header class="h-16 bg-[#1e293b]/50 backdrop-blur-md border-b border-slate-700 flex items-center justify-between px-8">
        <div class="flex items-center space-x-4">
          <h2 class="text-lg font-semibold text-white">数据统计</h2>
          <span class="text-xs bg-slate-700 text-slate-400 px-2 py-1 rounded">近 30 天更新</span>
        </div>
        <div class="flex items-center space-x-3">
          <button class="bg-slate-800 hover:bg-slate-700 text-slate-200 px-4 py-2 rounded-lg text-sm font-medium transition-all border border-slate-700" onclick="loadStats()">刷新数据</button>
        </div>
      </header>

      <section class="flex-1 overflow-auto p-8 hide-scrollbar space-y-8">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="bg-[#1e293b] border border-slate-700 rounded-2xl p-6 shadow-xl">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-xs uppercase tracking-widest text-slate-500">工具总数</p>
                <p class="text-3xl font-bold text-white mt-2" id="stat-tools">0</p>
              </div>
              <div class="w-12 h-12 rounded-xl bg-indigo-600/20 flex items-center justify-center text-indigo-400">
                <span class="iconify text-2xl" data-icon="heroicons:command-line-20-solid"></span>
              </div>
            </div>
            <p class="text-sm text-slate-400 mt-4">平台累计收录</p>
          </div>
          <div class="bg-[#1e293b] border border-slate-700 rounded-2xl p-6 shadow-xl">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-xs uppercase tracking-widest text-slate-500">分类数量</p>
                <p class="text-3xl font-bold text-white mt-2" id="stat-categories">0</p>
              </div>
              <div class="w-12 h-12 rounded-xl bg-emerald-600/20 flex items-center justify-center text-emerald-400">
                <span class="iconify text-2xl" data-icon="heroicons:tag-20-solid"></span>
              </div>
            </div>
            <p class="text-sm text-slate-400 mt-4">覆盖不同场景</p>
          </div>
          <div class="bg-[#1e293b] border border-slate-700 rounded-2xl p-6 shadow-xl">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-xs uppercase tracking-widest text-slate-500">近 30 天新增</p>
                <p class="text-3xl font-bold text-white mt-2" id="stat-last30">0</p>
              </div>
              <div class="w-12 h-12 rounded-xl bg-orange-500/20 flex items-center justify-center text-orange-400">
                <span class="iconify text-2xl" data-icon="heroicons:arrow-trending-up-20-solid"></span>
              </div>
            </div>
            <p class="text-sm text-slate-400 mt-4">新增工具数量</p>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <div class="bg-[#1e293b] border border-slate-700 rounded-2xl p-6 shadow-xl">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-lg font-semibold text-white">热门分类</h3>
              <span class="text-xs text-slate-500">Top 5</span>
            </div>
            <div id="top-categories" class="space-y-4"></div>
          </div>
          <div class="bg-[#1e293b] border border-slate-700 rounded-2xl p-6 shadow-xl">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-lg font-semibold text-white">最新收录</h3>
              <span class="text-xs text-slate-500">最近 5 条</span>
            </div>
            <div id="latest-tools" class="space-y-4"></div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    const API_BASE = '';

    function renderTopCategories(items) {
      const container = document.getElementById('top-categories');
      container.innerHTML = '';
      if (!items.length) {
        container.innerHTML = '<p class="text-sm text-slate-400">暂无数据</p>';
        return;
      }
      const maxCount = Math.max(...items.map((item) => item.count), 1);
      items.forEach((item) => {
        const percent = Math.round((item.count / maxCount) * 100);
        const row = document.createElement('div');
        row.innerHTML = `
          <div class="flex items-center justify-between text-sm">
            <span class="text-slate-200">${item.name}</span>
            <span class="text-slate-400">${item.count} 个</span>
          </div>
          <div class="mt-2 h-2 w-full bg-slate-800 rounded-full overflow-hidden">
            <div class="h-full bg-indigo-500" style="width: ${percent}%"></div>
          </div>
        `;
        container.appendChild(row);
      });
    }

    function renderLatestTools(items) {
      const container = document.getElementById('latest-tools');
      container.innerHTML = '';
      if (!items.length) {
        container.innerHTML = '<p class="text-sm text-slate-400">暂无数据</p>';
        return;
      }
      items.forEach((tool) => {
        const row = document.createElement('div');
        row.className = 'p-4 bg-slate-800/40 border border-slate-700 rounded-xl';
        row.innerHTML = `
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-semibold text-white">${tool.title}</p>
              <p class="text-xs text-slate-500 mt-1">${tool.category}</p>
            </div>
            <a class="text-xs text-indigo-400 hover:text-indigo-300" href="${tool.url}" target="_blank" rel="noopener noreferrer">访问</a>
          </div>
          <p class="text-xs text-slate-500 mt-2">${new Date(tool.created_at).toLocaleString()}</p>
        `;
        container.appendChild(row);
      });
    }

    async function loadStats() {
      try {
        const res = await fetch(`${API_BASE}/api/stats`);
        if (!res.ok) throw new Error('Request failed');
        const data = await res.json();
        document.getElementById('stat-tools').textContent = data.totalTools ?? 0;
        document.getElementById('stat-categories').textContent = data.totalCategories ?? 0;
        document.getElementById('stat-last30').textContent = data.toolsLast30Days ?? 0;
        renderTopCategories(data.topCategories || []);
        renderLatestTools(data.latestTools || []);
      } catch (err) {
        document.getElementById('top-categories').innerHTML = '<p class="text-sm text-rose-400">加载失败，请确认后端已启动。</p>';
        document.getElementById('latest-tools').innerHTML = '<p class="text-sm text-rose-400">加载失败，请确认后端已启动。</p>';
      }
    }

    loadStats();
  </script>
</body>
</html>
