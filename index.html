<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>程序员工具合集 - DevToolBox</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.iconify.design/3/3.1.1/iconify.min.js"></script>
  <style>
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    html::-webkit-scrollbar, body::-webkit-scrollbar { display: none; }
    html, body { -ms-overflow-style: none; scrollbar-width: none; }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-in-up { animation: fadeInUp 0.5s ease-out forwards; }
  </style>
</head>
<body class="bg-[#0f172a] text-slate-200 min-h-screen font-sans flex flex-col">
  <nav class="sticky top-0 z-50 bg-[#0f172a]/80 backdrop-blur-xl border-b border-slate-800 px-6 py-4">
    <div class="max-w-7xl mx-auto flex flex-col md:flex-row md:items-center justify-between gap-4">
      <div class="flex items-center gap-2">
        <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center shadow-lg shadow-indigo-500/20">
          <span class="iconify text-white text-2xl" data-icon="heroicons:command-line"></span>
        </div>
        <div>
          <h1 class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400">DevToolBox</h1>
          <p class="text-xs text-slate-500">2026.01.28 | 为开发者而生</p>
        </div>
      </div>
      <div class="relative flex-1 max-w-md">
        <span class="iconify absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" data-icon="heroicons:magnifying-glass"></span>
        <input id="search-input" class="w-full bg-slate-800/50 border border-slate-700 rounded-full py-2.5 pl-11 pr-4 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all text-sm" placeholder="搜索你需要的工具..." type="text" />
      </div>
    </div>
  </nav>

  <main class="max-w-7xl mx-auto px-6 py-8 flex-1 w-full">
    <section class="mb-10 animate-fade-in-up">
      <div id="filter-bar" class="flex items-center gap-3 overflow-x-auto pb-4 hide-scrollbar"></div>
    </section>

    <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="tools-grid"></section>

    <section class="mt-20 border-t border-slate-800 pt-12">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
        <div class="text-center">
          <div class="text-3xl font-bold text-white mb-1" id="stats-total">0</div>
          <div class="text-xs text-slate-500 uppercase tracking-widest">在线工具</div>
        </div>
        <div class="text-center">
          <div class="text-3xl font-bold text-white mb-1">2.4M</div>
          <div class="text-xs text-slate-500 uppercase tracking-widest">每月请求</div>
        </div>
        <div class="text-center">
          <div class="text-3xl font-bold text-white mb-1">100%</div>
          <div class="text-xs text-slate-500 uppercase tracking-widest">隐私安全</div>
        </div>
        <div class="text-center">
          <div class="text-3xl font-bold text-white mb-1">开源</div>
          <div class="text-xs text-slate-500 uppercase tracking-widest">Github 社区</div>
        </div>
      </div>
    </section>
  </main>

  <footer class="border-t border-slate-800 bg-[#070b14] py-12 px-6 mt-auto">
    <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-8">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 bg-slate-800 rounded-lg flex items-center justify-center">
          <span class="iconify text-slate-400" data-icon="heroicons:code-bracket"></span>
        </div>
        <p class="text-sm text-slate-500" id="footer-text">© 2026 DevToolBox Project. All rights reserved.</p>
      </div>
      <div class="flex gap-6">
        <a id="footer-github" class="text-slate-400 hover:text-white transition-colors" href="#" target="_blank" rel="noopener noreferrer">
          <span class="iconify text-2xl" data-icon="mdi:github"></span>
        </a>
        <a id="footer-zsxq" class="text-slate-400 hover:text-white transition-colors" href="#" target="_blank" rel="noopener noreferrer" aria-label="知识星球">
          <span class="w-6 h-6 inline-block" style="background-color: currentColor; mask: url('https://raw.githubusercontent.com/Y-Unfettered/ImageLibrary/d812596c14ba1f97b7b25957263012d27681e335/%E6%98%9F%E9%99%85%E7%9F%BF%E5%9C%BA.svg') no-repeat center / contain; -webkit-mask: url('https://raw.githubusercontent.com/Y-Unfettered/ImageLibrary/d812596c14ba1f97b7b25957263012d27681e335/%E6%98%9F%E9%99%85%E7%9F%BF%E5%9C%BA.svg') no-repeat center / contain;"></span>
        </a>
        <button id="footer-email" class="text-slate-400 hover:text-white transition-colors" type="button" aria-label="复制邮箱">
          <span class="iconify text-2xl" data-icon="mdi:email"></span>
        </button>
      </div>
    </div>
  </footer>
  <div id="toast" class="fixed bottom-6 right-6 bg-slate-900/90 text-slate-100 text-sm px-4 py-2 rounded-xl border border-slate-700 shadow-xl hidden">邮箱已复制</div>

  <script>
    const API_BASE = '';
    const STATIC_DATA_URL = 'data/devtoolbox.json';
    const grid = document.getElementById('tools-grid');
    const filterBar = document.getElementById('filter-bar');
    const searchInput = document.getElementById('search-input');
    const statsTotal = document.getElementById('stats-total');

    const palette = [
      { badge: 'bg-indigo-500/10 text-indigo-300', border: 'hover:border-indigo-500/50', glow: 'hover:shadow-indigo-500/10', icon: 'text-indigo-400', btn: 'group-hover:bg-indigo-600' },
      { badge: 'bg-emerald-500/10 text-emerald-300', border: 'hover:border-emerald-500/50', glow: 'hover:shadow-emerald-500/10', icon: 'text-emerald-400', btn: 'group-hover:bg-emerald-600' },
      { badge: 'bg-cyan-500/10 text-cyan-300', border: 'hover:border-cyan-500/50', glow: 'hover:shadow-cyan-500/10', icon: 'text-cyan-400', btn: 'group-hover:bg-cyan-600' },
      { badge: 'bg-orange-500/10 text-orange-300', border: 'hover:border-orange-500/50', glow: 'hover:shadow-orange-500/10', icon: 'text-orange-400', btn: 'group-hover:bg-orange-600' },
      { badge: 'bg-pink-500/10 text-pink-300', border: 'hover:border-pink-500/50', glow: 'hover:shadow-pink-500/10', icon: 'text-pink-400', btn: 'group-hover:bg-pink-600' },
      { badge: 'bg-yellow-500/10 text-yellow-300', border: 'hover:border-yellow-500/50', glow: 'hover:shadow-yellow-500/10', icon: 'text-yellow-400', btn: 'group-hover:bg-yellow-600' }
    ];

    const state = {
      category: 'all',
      q: ''
    };

    let allTools = [];

    function hashCategory(value) {
      let hash = 0;
      for (let i = 0; i < value.length; i += 1) {
        hash = (hash * 31 + value.charCodeAt(i)) % 997;
      }
      return hash;
    }

    function getStyle(category) {
      if (!category) return palette[0];
      const idx = hashCategory(category) % palette.length;
      return palette[idx];
    }

    function isUrl(value) {
      if (!value) return false;
      try { new URL(value); return true; } catch { return false; }
    }

    function renderFilters(categories) {
      filterBar.innerHTML = '';
      const allBtn = document.createElement('button');
      allBtn.className = 'px-6 py-2 rounded-full bg-indigo-600 text-white text-sm font-medium whitespace-nowrap transition-shadow hover:shadow-lg hover:shadow-indigo-500/30';
      allBtn.textContent = '全部工具';
      allBtn.dataset.category = 'all';
      filterBar.appendChild(allBtn);

      categories.forEach((cat) => {
        const btn = document.createElement('button');
        btn.className = 'px-6 py-2 rounded-full bg-slate-800 hover:bg-slate-700 text-slate-300 text-sm font-medium whitespace-nowrap transition-colors';
        btn.textContent = cat;
        btn.dataset.category = cat;
        filterBar.appendChild(btn);
      });

      filterBar.addEventListener('click', (e) => {
        const button = e.target.closest('button');
        if (!button) return;
        const selected = button.dataset.category;
        state.category = selected;
        Array.from(filterBar.children).forEach((child) => {
          child.classList.remove('bg-indigo-600', 'text-white');
          child.classList.add('bg-slate-800', 'text-slate-300');
        });
        button.classList.remove('bg-slate-800', 'text-slate-300');
        button.classList.add('bg-indigo-600', 'text-white');
        applyFilters();
      });
    }

    function renderTools(items) {
      grid.innerHTML = '';
      if (!items.length) {
        grid.innerHTML = '<div class="col-span-full text-center text-slate-400 py-16">暂无工具，请在后台添加。</div>';
        return;
      }

      items.forEach((tool, index) => {
        const style = palette[index % palette.length];
        const iconMarkup = isUrl(tool.icon)
          ? `<img src="${tool.icon}" alt="${tool.title}" class="w-6 h-6 object-contain" />`
          : `<span class="iconify ${style.icon} text-2xl" data-icon="${tool.icon || 'heroicons:command-line'}"></span>`;

        const card = document.createElement('div');
        card.className = `group bg-slate-800/40 border border-slate-700 p-6 rounded-2xl hover:bg-slate-800 ${style.border} hover:shadow-2xl ${style.glow} transition-all duration-300 flex flex-col justify-between`;
        card.innerHTML = `
          <div>
            <div class="flex justify-between items-start mb-4">
              <div class="w-12 h-12 bg-slate-900/40 rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
                ${iconMarkup}
              </div>
              <span class="${style.badge} text-[10px] px-2 py-0.5 rounded uppercase font-bold tracking-wider">${tool.category}</span>
            </div>
            <h3 class="text-lg font-semibold mb-2 group-hover:text-white">${tool.title}</h3>
            <p class="text-sm text-slate-400 leading-relaxed mb-6">${tool.summary}</p>
          </div>
          <a class="w-full bg-slate-700 ${style.btn} text-white py-2.5 rounded-xl font-medium flex items-center justify-center gap-2 transition-all" href="${tool.url}" target="_blank" rel="noopener noreferrer">
            立即使用
            <span class="iconify" data-icon="heroicons:arrow-right"></span>
          </a>
        `;
        grid.appendChild(card);
      });
    }

    function applyFilters() {
      const keyword = state.q.toLowerCase();
      let items = allTools;
      if (state.category && state.category !== 'all') {
        items = items.filter((tool) => tool.category === state.category);
      }
      if (keyword) {
        items = items.filter((tool) => {
          const title = (tool.title || '').toLowerCase();
          const summary = (tool.summary || '').toLowerCase();
          return title.includes(keyword) || summary.includes(keyword);
        });
      }
      renderTools(items);
    }

    function applySettings(items) {
      const map = {};
      (items || []).forEach((item) => { map[item.key] = item.value; });
      const footerText = document.getElementById('footer-text');
      if (footerText && map.footerText) footerText.textContent = map.footerText;
      const github = document.getElementById('footer-github');
      if (github && map.githubUrl) github.href = map.githubUrl;
      const zsxq = document.getElementById('footer-zsxq');
      if (zsxq && map.zsxqUrl) zsxq.href = map.zsxqUrl;
      const emailBtn = document.getElementById('footer-email');
      if (emailBtn) emailBtn.dataset.email = map.contactEmail || '';
    }

    async function fetchApiData() {
      const [toolsRes, settingsRes] = await Promise.all([
        fetch(`${API_BASE}/api/tools?limit=200`),
        fetch(`${API_BASE}/api/settings`)
      ]);
      if (!toolsRes.ok || !settingsRes.ok) throw new Error('Request failed');
      const [toolsData, settingsData] = await Promise.all([toolsRes.json(), settingsRes.json()]);
      return { tools: toolsData, settings: settingsData };
    }

    async function fetchStaticData() {
      const res = await fetch(STATIC_DATA_URL);
      if (!res.ok) throw new Error('Static data not found');
      return res.json();
    }

    async function init() {
      try {
        const data = await fetchApiData();
        allTools = data.tools.items || [];
        const categories = Array.from(new Set(allTools.map((item) => item.category))).filter(Boolean);
        renderFilters(categories);
        applyFilters();
        statsTotal.textContent = allTools.length;
        applySettings((data.settings && data.settings.items) || []);
      } catch (err) {
        try {
          const data = await fetchStaticData();
          allTools = (data.tools && data.tools.items) || [];
          const categories = Array.from(new Set(allTools.map((item) => item.category))).filter(Boolean);
          renderFilters(categories);
          applyFilters();
          statsTotal.textContent = allTools.length;
          applySettings((data.settings && data.settings.items) || []);
        } catch (staticErr) {
          renderFilters([]);
          grid.innerHTML = '<div class="col-span-full text-center text-rose-400 py-16">加载失败，请确认后端已启动或已导出 data/devtoolbox.json。</div>';
        }
      }
    }

    function showToast(message) {
      const toast = document.getElementById('toast');
      if (!toast) return;
      toast.textContent = message;
      toast.classList.remove('hidden');
      clearTimeout(window.__toastTimer);
      window.__toastTimer = setTimeout(() => {
        toast.classList.add('hidden');
      }, 1800);
    }

    let debounceTimer = null;
    searchInput.addEventListener('input', (e) => {
      state.q = e.target.value.trim();
      clearTimeout(debounceTimer);
      debounceTimer = setTimeout(applyFilters, 300);
    });

    document.getElementById('footer-email').addEventListener('click', async () => {
      const email = document.getElementById('footer-email').dataset.email || '';
      if (!email) return;
      try {
        await navigator.clipboard.writeText(email);
        showToast('邮箱已复制');
      } catch {
        showToast('复制失败，请手动复制');
      }
    });

    init();
  </script>
</body>
</html>
